<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="style.css">
    <script type="text/javascript" src="scripts/web3/dist/web3.js"></script>
    <script src="scripts/jquery/dist/jquery.js"></script>
    <script>
        web3 = new Web3();
        web3.setProvider(new web3.providers.HttpProvider("http://localhost:8545"));
        var accounts = web3.eth.accounts;
        console.log(accounts);
    </script>

</head>

<body>
    <h1>The Decentralised Stock Exchange</h1>
    <div id="Navi">
        <ul>
          <li><a href="/DollarExchange.html">Buy/Sell Bytedollar</a></li>
          <li><a href="/StockExchange.html">Stock Exchange</a></li>
          <li><a href="/Accounts.html">Accounts</a></li>
          <li><a href="/TokenExchange.html">Token Exchange</a></li>
          <li><a href="/Contact.html">Contact</a></li>
        </ul>
    </div>
    <div id="accountTable"></div>

    <script>
        function createTable(inputArray) {
            var body = document.getElementsByTagName('body')[0];
            var tbl = document.createElement('table');
            var tbdy = document.createElement('tbody');
            var tr = document.createElement('tr');
            var th1 = document.createElement('th');

            th1.appendChild(document.createTextNode("Account Number"))
            tr.appendChild(th1);
            var th2 = document.createElement('th');
            th2.appendChild(document.createTextNode("Ether Balance"))
            tr.appendChild(th2);
            tbdy.appendChild(tr);

            for (i = 0; i < inputArray.length; i += 2) {
                var tr = document.createElement('tr');
                var accountNumbertd1 = document.createElement('td');
                accountNumbertd1.appendChild(document.createTextNode(inputArray[i]))
                tr.appendChild(accountNumbertd1)
                var accountNumbertd2 = document.createElement('td');
                accountNumbertd2.appendChild(document.createTextNode(inputArray[i + 1]))
                tr.appendChild(accountNumbertd2)
                tbdy.appendChild(tr);
            }

            tbl.appendChild(tbdy);
            document.getElementById("accountTable").appendChild(tbl)
        }

        var accountsJSON = "";
        for (i in web3.eth.accounts) {
            var x = Math.round(web3.fromWei(web3.eth.getBalance(web3.eth.accounts[i]),"ether")*100)/100
            accountsJSON += web3.eth.accounts[i] + "," + x;
            if (i != web3.eth.accounts.length - 1) accountsJSON += ",";
        }
        accountsJSON = accountsJSON.replace(/"/g, "")
        accountsJSON = accountsJSON.replace(']', "")
        accountsJSON = accountsJSON.replace('[', "")
        accountsJSON = accountsJSON.split(',');

        createTable(accountsJSON);
    </script>

</body>

</html>
